// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

enum LEVEL {
  HIGHEST
  BASIC
}

enum Status {
  Hadir
  Izin
  Sakit
  Alpha
  Terlambat
}

model Major {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  acronym String   @unique
  class   String[]
  group   String[]

  @@index([name])
}

model Student {
  id                Int                 @id @default(autoincrement())
  fullName          String              @unique
  placement         String
  nis               String              @unique
  absenceId         Int
  deviceId          String?
  deviceName        String?
  PresenceToStudent PresenceToStudent[]

  @@index([fullName, nis])
}

model Administrator {
  id          Int      @id @default(autoincrement())
  fullName    String   @unique
  nip         String   @unique
  level       LEVEL    @default(BASIC)
  access      String[]
  phoneNumber String
  login       Boolean  @default(false)

  @@index([fullName, nip])
}

model Presence {
  id                Int                 @id @default(autoincrement())
  open              Boolean             @default(false)
  openAt            DateTime            @default(now())
  PresenceToStudent PresenceToStudent[]
}

model PresenceToStudent {
  presenceId Int
  studentId  Int?

  status Status @default(Alpha)

  student  Student? @relation(fields: [studentId], references: [id])
  presence Presence @relation(fields: [presenceId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  @@id([presenceId])
}
